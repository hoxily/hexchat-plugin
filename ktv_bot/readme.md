# ktv_bot插件说明

这是一个用在hexchat上的插件，可以实现自助点歌。

整个点歌功能由两部分组成，其中一个是运行在hexchat之上的python脚本插件，监听hexchat的Text Event，主要是Channel Message打印事件。对频道中的每一条消息都进行识别，判断是否符合点歌指令格式，并进行处理。另一个部分则是播放器模块。播放器模块这里比较麻烦的地方在于，想要实现自由点歌，需要一个庞大的乐曲库，显然个人难以做到。此处借助了网易云音乐。

网易云音乐并没有提供公开的接口，所以此处采用了脚本注入的方式实现搜索与播放的功能。

播放器模块负责排队、搜索歌曲并加以播放。hexchat插件模块则负责接收频道内用户的点歌指令，将点歌指令发送给播放器模块。二者之间通过本地的一个js文件实现沟通。

播放器模块可以拆分为两块，一块是运行网易云音乐的浏览器，一块是本地架设的简单web服务器。通过向标准的网易云音乐页面注入自定义脚本，设立定时器，周期性地读取用作沟通的js文件，判断是否有新歌曲被点播。

## 点歌指令

有两种点歌指令需要识别，一种是由teleboto转发机器人转发的发言，里面可能含有点歌指令；另一种是正常irc用户的发言，里面可能含有点歌指令。

标准的点歌指令如下：

`点歌 歌名`

支持简体中文与繁体。
